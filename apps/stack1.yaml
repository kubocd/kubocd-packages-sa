
apiVersion: v1alpha1
metadata:
  type: Application
  name: stack1
  version: 0.1.0
spec:
  description: |
    A test stack with redis and podinfo
  parametersSchema:
    properties:
      tls: { type: boolean, default: false }
      redis:
        properties:
          replicaCount: { type: integer, default: 1 }
  modules:
    - name: main
      source:
        local:
          path: ../charts/wrapper/1.0.0
      values:
        body: |
          ---
          apiVersion: v1
          kind: Namespace
          metadata:
            name: {{ .Release.spec.targetNamespace }}
          ---
          apiVersion: kubocd.kubotal.io/v1alpha1
          kind: Release
          metadata:
            name: redis
            namespace: {{ .Release.spec.targetNamespace }}
          spec:
            description: "redis instance of {{ .Release.metadata.name }}"
            parameters:
              redis:
                replicaCount: {{ .Parameters.redis.replicaCount }}
              commander:
                tls: {{ .Parameters.tls }}
            application:
              repository: quay.io/kubocd/applications/redis
              tag: 0.1.0
              interval: 30m
          ---
          apiVersion: kubocd.kubotal.io/v1alpha1
          kind: Release
          metadata:
            name: podinfo
            namespace: {{ .Release.spec.targetNamespace }}
          spec:
            description: "podinfo instance of {{ .Release.metadata.name }}"
            application:
              repository: quay.io/kubocd/applications/podinfo
              tag: 0.1.0
              interval: 30m
            parameters:
              tls: {{ .Parameters.tls }}

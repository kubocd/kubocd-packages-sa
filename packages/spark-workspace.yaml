
apiVersion: v1alpha1
name: spark-workspace
tag: 0.1.0-p01
protected: false
schema:
  parameters:
    properties:
      namespace: { type: string, required: true }
      serviceAccountName: { type: string, default: "spark"}
      roleName: { type: string, default: "spark"}
      kyverno:
        properties:
          enabled: { type: boolean, default: false }
          namespace: { type: string, default: "kyverno" }
      kubernetesJobs:
        properties:
          manage: { type: boolean, default: true, description: "Allow the serviceAccount to manage Kubernetes jobs and cronjobs" }
      secretStore:
        properties:
          manage: { type: boolean, default: true, description: "Allow the serviceAccount to manage external-secret secretStore and externalSecrets" }
      s3access:
        properties:
          accessKey: { type: string, default: "" }
          secretKey: { type: string, default: "" }
      workflow:
        properties:
          manage: { type: boolean, default: true, description: "Allow the serviceAccount to manage Argo Workflow resources" }
          guiOidcGroups:
            description: "List of OIDC groups which will be impersonated in 'service' account on the Argo workflow server."
            items: { type: string }
modules:
  - name: main
    source:
      local:
        path: ../charts/spark-workspace/0.1.0
    values: |
      namespace: {{ .Parameters.namespace }}
      serviceAccountName: {{ .Parameters.serviceAccountName }}
      roleName: {{ .Parameters.roleName }}

      kyverno:
        enabled: {{ .Parameters.kyverno.enabled }}
        namespace: {{ .Parameters.kyverno.namespace }}

      kubernetesJobs:
        manage: {{ .Parameters.kubernetesJobs.manage }}

      secretStore:
        manage: {{ .Parameters.secretStore.manage }}

      s3access:
        accessKey: {{ .Parameters.s3access.accessKey }}
        secretKey: {{ .Parameters.s3access.secretKey }}

      workflow:
        manage: {{ .Parameters.workflow.manage }}
        guiOidcGroups: {{ .Parameters.workflow.guiOidcGroups | default (list) | toJson }}
